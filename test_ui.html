<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ–éŸ³æˆªå›¾æµ‹è¯•</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        input { width: 70%; padding: 10px; font-size: 16px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; background: #fe2c55; color: white; border: none; border-radius: 4px; }
        button:disabled { background: #ccc; }
        #result { margin-top: 20px; border: 1px solid #ddd; padding: 10px; min-height: 200px; }
        img { max-width: 100%; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .log { background: #f5f5f5; padding: 10px; font-family: monospace; font-size: 12px; height: 150px; overflow-y: scroll; border: 1px solid #eee; margin-bottom: 10px; }
    </style>
</head>
<body>
    <h1>ğŸ“¸ æˆªå›¾ API æµ‹è¯•å·¥å…·</h1>
    <p>è¾“å…¥æŠ–éŸ³ä¸ªäººä¸»é¡µé“¾æ¥ï¼Œæµ‹è¯•å»å¼¹çª—æ•ˆæœã€‚</p>
    
    <div style="margin-bottom: 10px;">
        <input type="text" id="urlInput" value="https://www.douyin.com/user/MS4wLjABAAAAl772J8S_5bblTWU5GsGNMZSGnyi9r8r2YFkULTV6nsc" placeholder="è¾“å…¥é“¾æ¥...">
        <button onclick="takeScreenshot()" id="btn">å¼€å§‹æˆªå›¾</button>
    </div>

    <div class="log" id="logs"></div>
    <div id="result"></div>

    <script>
        function log(msg) {
            const el = document.getElementById('logs');
            el.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>`;
            el.scrollTop = el.scrollHeight;
        }

        async function takeScreenshot() {
            const url = document.getElementById('urlInput').value;
            const btn = document.getElementById('btn');
            const resultDiv = document.getElementById('result');
            
            if (!url) return alert('è¯·è¾“å…¥é“¾æ¥');
            
            btn.disabled = true;
            btn.innerText = 'æˆªå›¾ç”Ÿæˆä¸­...';
            resultDiv.innerHTML = '<p>æ­£åœ¨è¯·æ±‚ API...</p>';
            log(`å¼€å§‹è¯·æ±‚: ${url}`);

            try {
                const res = await fetch('http://localhost:3002/api/screenshot', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });

                log(`å“åº”çŠ¶æ€: ${res.status}`);
                const data = await res.json();

                if (data.success) {
                    log('âœ… æˆªå›¾æˆåŠŸï¼');
                    resultDiv.innerHTML = `
                        <h3>æˆªå›¾ç»“æœï¼š</h3>
                        <p>URL: <a href="${data.data.url}" target="_blank">${data.data.url}</a></p>
                        <img src="${data.data.image}" alt="æˆªå›¾">
                    `;
                } else {
                    log(`âŒ å¤±è´¥: ${data.error}`);
                    resultDiv.innerHTML = `<p style="color:red">é”™è¯¯: ${data.error}</p>`;
                }
            } catch (e) {
                log(`âŒ ç½‘ç»œé”™è¯¯: ${e.message}`);
                resultDiv.innerHTML = `<p style="color:red">ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·ç¡®ä¿ server:dev å·²å¯åŠ¨</p>`;
            } finally {
                btn.disabled = false;
                btn.innerText = 'å¼€å§‹æˆªå›¾';
            }
        }
    </script>
</body>
</html>
